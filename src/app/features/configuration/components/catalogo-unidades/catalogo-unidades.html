<div class="catalogo-unidades__container max-w-[78rem] mx-auto px-4 sm:px-6">
  <div class="flex justify-between items-center mb-4">
    <div class="relative">
      <input type="text" placeholder="Buscar unidad" [(ngModel)]="searchTerm" (input)="onSearch()" class="pl-8 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring focus:ring-blue-200" />
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 absolute left-2 top-2.5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z"/></svg>
    </div>
    <div class="flex gap-2">
      <button (click)="toggleFilter()" [class.bg-blue-100]="showFilter" [class.text-blue-700]="showFilter" class="flex items-center gap-1.5 px-5 py-1.5 border rounded-xl text-sm text-gray-600 hover:bg-gray-100 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="currentColor"><path d="M440-160q-17 0-28.5-11.5T400-200v-240L168-736q-15-20-4.5-42t36.5-22h560q26 0 36.5 22t-4.5 42L560-440v240q0 17-11.5 28.5T520-160h-80Zm40-308 198-252H282l198 252Zm0 0Z"/></svg>
        Filtros
        @if (Object.keys(activeFilters).length > 0) {
          <span class="bg-blue-600 text-white text-xs rounded-full px-1.5 py-0.5 ml-1">{{ Object.keys(activeFilters).length }}</span>
        }
      </button>
      <button class="bg-blue-600 text-white text-sm px-5 py-1.5 rounded-xl hover:bg-blue-700" (click)="openAddModal()">+ AÃ±adir</button>
    </div>
  </div>

  @if (showFilter) {
  <div class="relative inline-block w-full mb-4">
    <div class="absolute -top-2 left-[85%] transform -translate-x-1/2 w-4 h-4 bg-white border-t border-l border-blue-400 rotate-45"></div>
    <div class="border border-blue-400 rounded-xl p-6 shadow-sm bg-white">
      <form [formGroup]="filterForm" (ngSubmit)="onApplyFilter()">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          @for (field of filterConfig.fields; track field.key) {
          <div>
            <label class="block text-sm font-semibold text-gray-800 mb-2">{{ field.label }}</label>
            @if (field.type === 'text') {
            <input type="search" [placeholder]="field.placeholder" [formControlName]="field.key" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring focus:ring-blue-200" />
            }
          </div>
          }
        </div>
        <div class="flex items-center justify-between mt-6">
          <button type="button" (click)="onResetFilter()" class="text-sm text-blue-600 hover:underline">Limpiar</button>
          <div class="flex space-x-3">
            <button type="button" (click)="toggleFilter()" class="px-5 py-1.5 text-sm rounded-xl border border-blue-400 text-blue-600 hover:bg-blue-50">Cancelar</button>
            <button type="submit" class="px-5 py-1.5 text-sm rounded-xl bg-blue-600 text-white hover:bg-blue-700">Aplicar</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  }

  <app-data-table 
    [columns]="columns"
    [data]="filteredItems"
    [itemsPerPage]="itemsPerPage"
    [pageSizes]="[4,8,12]"
    (edit)="onEdit($event)"
    (remove)="onRemove($event)">
  </app-data-table>

  <app-data-modal [isOpen]="showModal" [title]="modalTitle" [fields]="modalFields" (closed)="closeModal()" (submitted)="onModalSubmit($event)"></app-data-modal>

  <app-notification-container />
  <app-confirmation-modal [isOpen]="showConfirmation" [config]="confirmationConfig" (confirmed)="onConfirmDelete()" (cancelled)="onCancelDelete()" />

</div>
